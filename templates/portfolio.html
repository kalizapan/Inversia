{% extends 'base.html' %}
{% block title %}Mi Portafolio · Inversia{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-md-8">
    <!-- Agregar nuevo ticker -->
    <div class="card shadow-sm mb-4">
      <div class="card-body">
        <h3 class="card-title">Mi Portafolio</h3>
        <form method="POST" action="{{ url_for('add_portfolio') }}"
              class="row g-3 needs-validation mb-4" novalidate>
          <div class="col-auto flex-grow-1">
            <input
              type="text"
              name="ticker"
              class="form-control"
              placeholder="Ticker (Ej: MSFT)"
              required
              pattern="^(?!.*\s{2,}).*\S.*$"
              maxlength="5"
              title="Máx. 5 caracteres, no espacios dobles ni solo espacios."
            >
            <div class="invalid-feedback">Ingresa un ticker válido.</div>
          </div>
          <div class="col-auto">
            <button type="submit" class="btn btn-info">
              <i class="fa-solid fa-plus"></i> Agregar
            </button>
          </div>
        </form>

        {% if error %}
          <div class="alert alert-warning">{{ error }}</div>
        {% endif %}
        {% if tickers %}
        <ul class="list-group mb-4">
          {% for t in tickers %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              {{ t }}
              <form method="POST" action="{{ url_for('delete_portfolio') }}">
                <input type="hidden" name="ticker" value="{{ t }}">
                <button
                  type="submit"
                  class="btn btn-sm btn-danger"
                  title="Eliminar {{ t }}"
                  onclick="return confirm('¿Seguro que quieres eliminar {{ t }}?');"
                >
                  <i class="fa-solid fa-trash"></i>
                </button>
              </form>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="text-muted">Portafolio vacío.</p>
      {% endif %}
      </div>
    </div>

    {% if consolidated and individual %}
    <!-- Gráfica consolidada -->
    <div class="card shadow-sm mb-4">
      <div class="card-body text-center">
        <h5 class="card-title">Rendimiento Consolidado</h5>
        <img src="{{ url_for('static', filename=consolidated) }}"
             class="img-fluid rounded" alt="Consolidado">
      </div>
    </div>
    <!-- Gráfica individual -->
    <div class="card shadow-sm mb-4">
      <div class="card-body text-center">
        <h5 class="card-title">Rendimiento por Activo</h5>
        <img src="{{ url_for('static', filename=individual) }}"
             class="img-fluid rounded" alt="Individual">
      </div>
    </div>

    <!-- Compartir por correo -->
    <div class="card shadow-sm mb-4">
      <div class="card-body">
        <h5 class="card-title">Compartir por correo</h5>
        {% if message %}
          <div class="alert alert-info">{{ message }}</div>
        {% endif %}
        <form method="POST" class="row g-3 needs-validation" novalidate>
          <div class="col-auto flex-grow-1">
            <input
              type="email"
              name="email"
              class="form-control"
              placeholder="Destinatario"
              required
              pattern="^(?!.*\s{2,}).*\S.*$"
              maxlength="50"
              title="Máx. 50 caracteres, no espacios dobles ni solo espacios."
            >
            <div class="invalid-feedback">Ingresa un correo válido.</div>
          </div>
          <div class="col-auto">
            <button type="submit" class="btn btn-primary">
              <i class="fa-solid fa-paper-plane"></i> Enviar PDF
            </button>
          </div>
        </form>
      </div>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
